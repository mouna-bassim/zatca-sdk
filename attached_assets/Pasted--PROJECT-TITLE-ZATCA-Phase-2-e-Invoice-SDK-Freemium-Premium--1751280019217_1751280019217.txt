ğŸ”¹  PROJECT TITLE
â€œZATCA Phase-2 e-Invoice SDK â€“ Freemium + Premiumâ€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  BUSINESS RULES  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Free tier (â€œsandbox modeâ€)
    â€“ Can only call ZATCA **/simulation** endpoints.
    â€“ Hard-codes header `Clearance-Status: SIMULATION`.
    â€“ Prints a friendly message if the user tries to switch to production.

â€¢ Premium tier (â€œproduction modeâ€)
    â€“ Unlocked by a licence token in ENV or CLI flag.
    â€“ Allows apiBase = "https://gw-fatoora.zatca.gov.sa/e-invoicing/production".
    â€“ Adds:
         â–¸ automatic retry (3Ã—, exponential backoff)
         â–¸ helper to auto-renew the certificate 30 d before expiry
         â–¸ TypeScript typings (d.ts) for public API.

â€¢ Licence token format
    â€“ 20-char alphanumeric, starts with â€œZSDKâ€.
    â€“ validation = SHA-256 HMAC of the buyerâ€™s e-mail with a secret pepper
      (stub this as â€œalways validâ€ in demo; leave a TODO comment).
    â€“ ENV name:  `ZSDK_LICENCE_KEY`.
    â€“ CLI flag:  `--licence <token>` overrides ENV.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  DELIVERABLES  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. **Monorepo** with two npm packages:
      packages/core     â†’ free sandbox library (MIT).
      packages/pro      â†’ thin wrapper that imports core + prod extras.
2. Root README that explains:
      â–¸ â€œnpm i @zatca-sdk/coreâ€ for sandbox,
      â–¸ â€œnpm i @zatca-sdk/proâ€  for production + licence key,
      â–¸ how to obtain a key at `/buy.html` (placeholder).
3. `/buy.html` in /docs   â€“ dummy checkout button linking to Gumroad;
   shows where webhooks will go (no back-end code needed now).
4. License checker:
      `packages/pro/src/licence.js` exports `assertPremium()` â€“
      throws Error if key missing or invalid.
5. Update previous CLI demo:
      â–¸ `core-demo`  â†’ always simulation.
      â–¸ `pro-demo --licence $ZSDK_LICENCE_KEY`  â†’ production URL.
      If licence invalid, print:
         "â›”  Premium features locked â€“ get a key at /buy.html"
6. Jest tests:
      â–¸ licence passes, prod endpoint allowed.
      â–¸ licence missing, prod call rejected with specific error.
7. *.replit* should run **core-demo** by default so free users see success.
8. Keep Arabic â†” English UI toggle in `server.js` but add a banner:
      â€œProduction mode requires licence keyâ€.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  TECH DETAILS  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Language: Node 18, ESM (â€œtypeâ€: â€œmoduleâ€).
â€¢ Internal packages use pnpm workspaces (or npm workspaces if simpler).
â€¢ licence validation stub:
      ```js
      import crypto from 'crypto';
      export function isValid(token){
        return /^ZSDK[A-Za-z0-9]{16}$/.test(token);
      }
      ```
â€¢ Exported public API from both packages:
      createCSR, buildInvoiceXML, signInvoice, generateTLVQR,
      submitForClearance.
      In core: prod functions throw â€œPremium onlyâ€.
      In pro: they work if licence valid.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  SUCCESS CRITERIA  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
When user clicks **Run**:
   1. Installs workspaces.
   2. Executes â€œcore-demoâ€: prints CLEARED (simulation).
   3. Prints: "ğŸ‘‰  Ready to unlock production: run  npm run pro-demo -- --licence <key>"

No front-end beyond the existing Express test page.  
No payment integration code yet â€“ just the placeholder.

Generate the full project now.
